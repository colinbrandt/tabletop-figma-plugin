(()=>{"use strict";({168:function(){var e=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function s(e){try{r(i.next(e))}catch(e){o(e)}}function l(e){try{r(i.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}r((i=i.apply(e,t||[])).next())}))};figma.showUI(__html__,{width:300,height:550});let t=!0,n=null;function i(e){n&&n.cancel(),n=figma.notify(e)}figma.on("selectionchange",(()=>e(void 0,void 0,void 0,(function*(){const e=figma.currentPage.selection.filter((e=>"GROUP"===e.type||"FRAME"===e.type||"INSTANCE"===e.type));if(figma.ui.postMessage({type:"update-selection-count",count:e.length}),a(),t&&e.length>0){const t=e.filter((e=>"GROUP"===e.type||"FRAME"===e.type||"INSTANCE"===e.type));t.length>0&&function(e){const t=e.slice().sort(((e,t)=>{const n=e.parent;return null===n?0:n.children.indexOf(e)-n.children.indexOf(t)}));for(const e of t)e.parent&&e.parent.appendChild(e)}(t)}if(1===e.length){figma.ui.postMessage({type:"loading-card"}),console.log('Sent "loading-card" message');const t=e[0],n=yield l(t);figma.ui.postMessage({type:"preview-card",data:n}),console.log('Sent "preview-card" message with data')}else figma.ui.postMessage({type:"preview-card",data:null}),console.log('Sent "preview-card" message with null data')})))),figma.ui.onmessage=n=>e(void 0,void 0,void 0,(function*(){var e;if("update-bring-to-top-toggle"===n.type&&(e=n.value,t=e),"randomize-order"===n.type){const e=figma.currentPage.selection;if(e.length>0){const t=e[0].parent;t?(o(e).forEach((e=>t.appendChild(e))),i("Objects shuffled")):i("Selected layers do not have a common parent.")}else i("Please select some layers.")}if("toggle-flip-card"===n.type){const e=figma.currentPage.selection.filter((e=>"GROUP"===e.type||"FRAME"===e.type||"INSTANCE"===e.type));let t=!0;e.forEach((e=>{e.findAll((e=>"Face"===e.name)).length<2&&(t=!1)})),t?(e.forEach((e=>{const t=e.children.filter((e=>e.name.startsWith("Face")));if(t.length>0){const n=Math.floor(Math.random()*t.length);t.forEach(((e,t)=>{e.visible=t===n})),l(e)}})),i("Dice rolled")):(e.forEach((e=>s(e,!1))),i("Cards flipped"))}if("form-deck"===n.type){const e=figma.currentPage.selection.filter((e=>"INSTANCE"===e.type));if(e.length>0){const t=e[0].parent;if(t){const n=Math.min(...e.map((e=>e.x))),a=(e.reduce(((e,t)=>e+t.y),0),e.length,o(e));let l=Math.min(...a.map((e=>e.y)));a.forEach(((e,i)=>{"INSTANCE"===e.type&&(e.x=n,e.y=l-i,e.setPluginData("Flip card?","false"),s(e,!1),t.appendChild(e))})),i("Objects stacked and shuffled")}else i("Selected objects do not have the same parent")}else i("Please select some objects")}if("expand-deck"===n.type){const e=figma.currentPage.selection.filter((e=>"INSTANCE"===e.type));if(e.length>0){let t=e[0].x,n=e[0].y;e.forEach((e=>{s(e,!1),e.x=t,t+=e.width+16,e.y=n})),i("Objects expanded")}else i("Please select some objects")}}));const a=()=>{const e=figma.currentPage.selection.filter((e=>"GROUP"===e.type||"FRAME"===e.type||"INSTANCE"===e.type));if(0===e.length)return void figma.ui.postMessage({type:"disable-flip-button"});let t=!1,n=!0;e.forEach((e=>{const i=e.findChild((e=>"Front"===e.name)),a=e.findChild((e=>"Back"===e.name)),o=e.findAll((e=>"Face"===e.name));i&&a&&(t=!0),o.length<2&&(n=!1)})),n?figma.ui.postMessage({type:"enable-roll-button"}):t?figma.ui.postMessage({type:"enable-flip-button"}):figma.ui.postMessage({type:"disable-flip-button"})};function o(e){const t=[...e];for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}function s(e,t){const n=e.findChild((e=>"Front"===e.name)),i=e.findChild((e=>"Back"===e.name));n&&i&&(t?(n.visible=!0,i.visible=!1):(n.visible=!1,i.visible=!0))}function l(t){return e(this,void 0,void 0,(function*(){try{const e=t.findChild((e=>"Preview"===e.name));if(e&&"RECTANGLE"===e.type)if(Array.isArray(e.fills)){const t=e.fills;if(t.length>0){const e=t[0];if("IMAGE"===e.type&&e.imageHash){const t=figma.getImageByHash(e.imageHash);if(t){const e=yield t.getBytesAsync();return`<img src="${"data:image/png;base64,"+figma.base64Encode(e)}" alt="Preview" style="max-width: 100%; max-height: 100%;" />`}console.error("Image not found for imageHash:",e.imageHash)}}}else console.error("Preview layer fills is not an array");const n=t.clone(),i=t.findChild((e=>"Front"===e.name)),a=t.findChild((e=>"Back"===e.name));i&&a&&(i.visible=!0,a.visible=!1);const o=yield n.exportAsync({format:"SVG_STRING"});return n.remove(),o}catch(e){return console.error("Error generating preview data:",e),i("Error generating preview data"),""}}))}}})[168]()})();